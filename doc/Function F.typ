#import "@preview/fletcher:0.4.4" as fletcher: node, edge

#let func_img = [#fletcher.diagram(
  node((0, 0), $P_0$),
  node((1, 0), $P_1$),
  node((2, 0), $P_2$),
  node((3, 0), $P_3$),
  node((4, 0), $P_4$),
  node((5, 0), $P_5$),
  node((6, 0), $P_6$),
  node((7, 0), $P_7$),

  /* line 1 */
  edge((0, 1), (1, 1), "*-|>"),
  edge((2, 1), (1, 1), "*-|>"),
  edge((5, 1), (6, 1), "*-|>"),
  edge((7, 1), (6, 1), "*-|>"),
  node((1, 1), $xor$),
  node((6, 1), $xor$),

  /* line 2 */
  edge((4, 2), (2, 2), "*-|>"),
  node((1, 2), $<<< 3$),
  node((2, 2), $xor$),
  node((6, 2), $>>> 2$),

  /* line 3 */
  edge((3, 3), (5, 3), "*-|>"),
  edge((6, 3), (5, 3), "*-|>"),
  node((2, 3), $<<< 2$),
  node((5, 3), $xor$),

  /* line 4 */
  node((4, 4), $>>> 4$),

  /* line 5 */
  node((4, 5), $xor$),
  edge((1, 5), (4, 5), "*-|>"),

  /* line 6 */
  edge((4, 6), (3, 6), "*-|>"),
  edge((7, 6), (4, 6), "*-"),
  node((3, 6), $xor$),

  /* line 7 */
  node((5, 7), $<<< 1$),

  /* line 8 */
  edge((2, 8), (0, 8), "*-|>"),
  edge((5, 8), (7, 8), "*-|>"),
  node((0, 8), $xor$),
  node((7, 8), $xor$),

  /* column 0 */
  edge((0, 0), (0, 8), "-|>"),
  edge((0, 8), (0, 9), "-|>"),

  /* column 1 */
  edge((1, 0), (1, 1), "-|>"),
  edge((1, 1), (1, 2), "-|>"),
  edge((1, 2), (1, 9), "-|>"),

  /* column 2 */
  edge((2, 0), (2, 2), "-|>"),
  edge((2, 2), (2, 3), "-|>"),
  edge((2, 3), (2, 9), "-|>"),

  /* column 3 */
  edge((3, 0), (3, 6), "-|>"),
  edge((3, 6), (3, 9), "-|>"),

  /* column 4 */
  edge((4, 0), (4, 4), "-|>"),
  edge((4, 4), (4, 5), "-|>"),
  edge((4, 5), (4, 9), "-|>"),

  /* column 5 */
  edge((5, 0), (5, 3), "-|>"),
  edge((5, 3), (5, 7), "-|>"),
  edge((5, 7), (5, 9), "-|>"),

  /* column 6 */
  edge((6, 0), (6, 1), "-|>"),
  edge((6, 1), (6, 2), "-|>"),
  edge((6, 2), (6, 9), "-|>"),

  /* column 7 */
  edge((7, 0), (7, 8), "-|>"),
  edge((7, 8), (7, 9), "-|>"),

  /* apply key */
  node((0, 9), $xor K_0$),
  node((1, 9), $xor K_1$),
  node((2, 9), $xor K_2$),
  node((3, 9), $xor K_3$),
  node((4, 9), $xor K_4$),
  node((5, 9), $xor K_5$),
  node((6, 9), $xor K_6$),
  node((7, 9), $xor K_7$),

  /* shift columns */
  edge((0, 9), (0, 10), "-"),
  edge((1, 9), (1, 10), "-"),
  edge((2, 9), (2, 10), "-"),
  edge((3, 9), (3, 10), "-"),
  edge((4, 9), (4, 10), "-"),
  edge((5, 9), (5, 10), "-"),
  edge((6, 9), (6, 10), "-"),
  edge((7, 9), (7, 10), "-"),

  edge((0, 10), (2, 11), "-"),
  edge((1, 10), (3, 11), "-"),
  edge((2, 10), (6, 11), "-"),
  edge((3, 10), (7, 11), "-"),
  edge((4, 10), (0, 11), "-"),
  edge((5, 10), (1, 11), "-"),
  edge((6, 10), (4, 11), "-"),
  edge((7, 10), (5, 11), "-"),

  edge((0, 11), (0, 12), "-|>"),
  edge((1, 11), (1, 12), "-|>"),
  edge((2, 11), (2, 12), "-|>"),
  edge((3, 11), (3, 12), "-|>"),
  edge((4, 11), (4, 12), "-|>"),
  edge((5, 11), (5, 12), "-|>"),
  edge((6, 11), (6, 12), "-|>"),
  edge((7, 11), (7, 12), "-|>"),

  node((0, 12), $C_0$),
  node((1, 12), $C_1$),
  node((2, 12), $C_2$),
  node((3, 12), $C_3$),
  node((4, 12), $C_4$),
  node((5, 12), $C_5$),
  node((6, 12), $C_6$),
  node((7, 12), $C_7$),
)]
