#import "@preview/fletcher:0.5.8" as fletcher: node, edge

#let func_img = [#fletcher.diagram(
  node((0, 0), $P_0$),
  node((1, 0), $P_1$),
  node((2, 0), $P_2$),
  node((3, 0), $P_3$),
  node((4, 0), $P_4$),
  node((5, 0), $P_5$),
  node((6, 0), $P_6$),
  node((7, 0), $P_7$),

  /* line 1 */
  edge((0, 1), (1, 1), "*-|>"),
  edge((2, 1), (1, 1), "*-|>"),
  edge((5, 1), (6, 1), "*-|>"),
  edge((7, 1), (6, 1), "*-|>"),
  node((1, 1), $xor$),
  node((6, 1), $xor$),

  /* line 2 */
  edge((4, 2), (2, 2), "*-|>"),
  node((1, 2), $<<< 3$),
  node((2, 2), $xor$),
  node((6, 2), $>>> 2$),

  /* line 3 */
  edge((3, 2.5), (4.5, 2.5), "*-"),
  edge((4.5, 2.5), (5, 3), "-|>"),
  edge((6, 3), (5, 3), "*-|>"),
  node((2, 3), $<<< 2$),
  node((4, 3), $>>> 4$),
  node((5, 3), $xor$),


  /* line 4 */
  node((4, 4), $xor$),
  edge((1, 4), (4, 4), "*-|>"),
  node((5, 4), $<<< 1$),

  /* line 5 */
  edge((4, 4.5), (3.5, 4.5), "*-"),
  edge((3.5, 4.5), (3, 5), "-|>"),
  edge((7, 5), (3, 5), "*-|>"),
  node((3, 5), $xor$),

  /* line 6 */
  edge((2, 6), (0, 6), "*-|>"),
  edge((5, 6), (7, 6), "*-|>"),
  node((0, 6), $xor$),
  node((7, 6), $xor$),

  /* column 0 */
  edge((0, 0), (0, 6), "-|>"),
  edge((0, 6), (0, 8), "-|>"),

  /* column 1 */
  edge((1, 0), (1, 1), "-|>"),
  edge((1, 1), (1, 2), "-|>"),
  edge((1, 2), (1, 8), "-|>"),

  /* column 2 */
  edge((2, 0), (2, 2), "-|>"),
  edge((2, 2), (2, 3), "-|>"),
  edge((2, 3), (2, 8), "-|>"),

  /* column 3 */
  edge((3, 0), (3, 5), "-|>"),
  edge((3, 5), (3, 8), "-|>"),

  /* column 4 */
  edge((4, 0), (4, 3), "-|>"),
  edge((4, 3), (4, 4), "-|>"),
  edge((4, 4), (4, 8), "-|>"),

  /* column 5 */
  edge((5, 0), (5, 3), "-|>"),
  edge((5, 3), (5, 4), "-|>"),
  edge((5, 4), (5, 8), "-|>"),

  /* column 6 */
  edge((6, 0), (6, 1), "-|>"),
  edge((6, 1), (6, 2), "-|>"),
  edge((6, 2), (6, 8), "-|>"),

  /* column 7 */
  edge((7, 0), (7, 6), "-|>"),
  edge((7, 6), (7, 8), "-|>"),

  /* apply key */
  node((0, 8), $xor K_0$),
  node((1, 8), $xor K_1$),
  node((2, 8), $xor K_2$),
  node((3, 8), $xor K_3$),
  node((4, 8), $xor K_4$),
  node((5, 8), $xor K_5$),
  node((6, 8), $xor K_6$),
  node((7, 8), $xor K_7$),

  /* shift columns */
  edge((0, 8), (0, 9), "-"),
  edge((1, 8), (1, 9), "-"),
  edge((2, 8), (2, 9), "-"),
  edge((3, 8), (3, 9), "-"),
  edge((4, 8), (4, 9), "-"),
  edge((5, 8), (5, 9), "-"),
  edge((6, 8), (6, 9), "-"),
  edge((7, 8), (7, 9), "-"),

  edge((0, 9), (2, 10), "-"),
  edge((1, 9), (3, 10), "-"),
  edge((2, 9), (6, 10), "-"),
  edge((3, 9), (7, 10), "-"),
  edge((4, 9), (0, 10), "-"),
  edge((5, 9), (1, 10), "-"),
  edge((6, 9), (4, 10), "-"),
  edge((7, 9), (5, 10), "-"),

  edge((0, 10), (0, 11), "-|>"),
  edge((1, 10), (1, 11), "-|>"),
  edge((2, 10), (2, 11), "-|>"),
  edge((3, 10), (3, 11), "-|>"),
  edge((4, 10), (4, 11), "-|>"),
  edge((5, 10), (5, 11), "-|>"),
  edge((6, 10), (6, 11), "-|>"),
  edge((7, 10), (7, 11), "-|>"),

  node((0, 11), $C_0$),
  node((1, 11), $C_1$),
  node((2, 11), $C_2$),
  node((3, 11), $C_3$),
  node((4, 11), $C_4$),
  node((5, 11), $C_5$),
  node((6, 11), $C_6$),
  node((7, 11), $C_7$),
)]
